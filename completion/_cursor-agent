#compdef cursor-agent

_cursor-agent() {
    local -a commands options

    commands=(
        'install-shell-integration:Install shell integration to ~/.zshrc'
        'uninstall-shell-integration:Remove shell integration from ~/.zshrc'
        'login:Authenticate with Cursor'
        'logout:Sign out and clear stored authentication'
        'mcp:Manage MCP servers'
        'status:View authentication status'
        'whoami:View authentication status'
        'update:Update Cursor Agent to the latest version'
        'upgrade:Update Cursor Agent to the latest version'
        'create-chat:Create a new empty chat and return its ID'
        'agent:Start the Cursor Agent'
        'ls:List chat sessions'
        'resume:Resume the latest chat session'
        'help:Display help for command'
    )

    options=(
        '(-v --version)'{-v,--version}'[Output the version number]'
        '--api-key=[API key for authentication]:key:'
        '(-p --print)'{-p,--print}'[Print responses to console for scripts]'
        '--output-format=[Output format]:format:(text json stream-json)'
        '--stream-partial-output[Stream partial output as text deltas]'
        '(-b --background)'{-b,--background}'[Start in background mode]'
        '--resume=[Resume a chat session]:chatId:'
        '--model=[Model to use]:model:(gpt-5 sonnet-4 sonnet-4-thinking)'
        '(-f --force)'{-f,--force}'[Force allow commands unless explicitly denied]'
        '--approve-mcps[Automatically approve all MCP servers]'
        '--browser[Enable browser automation support]'
        '(-h --help)'{-h,--help}'[Display help for command]'
    )

    _arguments -s -S \
        "${options[@]}" \
        '1:command:->command' \
        '*::args:->args'

    case $state in
        command)
            _describe -t commands 'cursor-agent commands' commands
            ;;
        args)
            case $words[1] in
                mcp)
                    local -a mcp_cmds=(
                        'list:List configured MCP servers'
                        'add:Add an MCP server'
                        'remove:Remove an MCP server'
                    )
                    _describe -t commands 'mcp subcommands' mcp_cmds
                    ;;
                help)
                    _describe -t commands 'cursor-agent commands' commands
                    ;;
            esac
            ;;
    esac
}

_cursor-agent "$@"
